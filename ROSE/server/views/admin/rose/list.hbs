{{#extend "css"}}
	<!-- DataTables CSS -->
    <link href="/css/table/dataTables.bootstrap.css" rel="stylesheet">
    <!-- DataTables Responsive CSS -->
    <link href="/css/table/dataTables.responsive.css" rel="stylesheet">
{{/extend}}

<div id="body" ng-app="rosesList" ng-controller="list" hidden>
	{{> sidebar}}
	<div id="page-wrapper">
		</br>
		<div class="row">
			<div class="col-xs-12" id="warning" align="right" style="font-size:18px; color:orange;" hidden>
				Kết nối mạng không ổn định, dữ liệu có thể không được lấy đầy đủ
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<h1 class="page-header" ng-bind="tableTitle"></h1>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">
						Thông tin danh sách
					</div>
					<div class="panel-body">
						<table width="100%" class="table table-striped table-bordered table-hover" id="rosesTable">
							<thead>
								<tr style="background-color:#3F51B5; color:white;">
									<th style="text-align:center;">Hình đại diện</th>
									<th style="text-align:center;">Mã giống hoa</th>
									<th style="text-align:center;">Tên thường gọi</th>
									<th style="text-align:center;">Tên khoa học</th>
									<th style="text-align:center;">Loại</th>
									{{#ifIntersect roles "[stech, tech]"}}
										<th style="text-align:center;"></th>
									{{/ifIntersect}}
								</tr>
							</thead>
							<tbody>
								<tr class="content" align='center' ng-repeat="x in roses" id="{x.id}">
									<td><img class="b-lazy" style='width:100px; height:100px; border-radius:15%; -moz-border-radius:15%; -webkit-border-radius:15%;' ng-src='{x.imgsrc}'/></td>
									<td style='vertical-align:middle;'>{x.definedId}</td>
									<td style='vertical-align:middle;'>{x.name}</td>
									<td style='vertical-align:middle;'>{x.sciname}</td>
									<td style='vertical-align:middle;'>{x.type}</td>
									{{#ifIntersect roles "[stech, tech]"}}
										<td style='vertical-align:middle;'><button onclick="writeReviewClicked()" class="btn btn-primary">Viết bài</button></td>
									{{/ifIntersect}}
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		</br></br>
	</div>
	{{> footer}}
</div>

{{#extend "js"}}
	<script src="/js/blazy.min.js"></script>
	<!-- DataTables JavaScript -->
	<script src="/js/table/jquery.dataTables.min.js"></script>
    <script src="/js/table/dataTables.bootstrap.min.js"></script>
    <script src="/js/table/dataTables.responsive.js"></script>
	<script>
		var bLazy = new Blazy();
		let isReview = false;
		function writeReviewClicked() {
			isReview = true;
		}
		
		let app = angular.module('rosesList', []);
		app.controller('list', function($scope, $http) {
			function loaded() {
				$('body').on('click', '#rosesTable tr', function(){
					if (this.id && this.id.length > 0) {
						if (isReview) $(location).attr('href', '/admin/rose/review/' + this.id);
						else {
							'{{#ifIntersect roles "[stech, tech]"}}'
							$(location).attr('href', '/admin/rose/detail/' + this.id);
							'{{else}}'
							$(location).attr('href', '/admin/rose/detail/view/' + this.id);
							'{{/ifIntersect}}'
						}
					}
				});
				
				$(document).ready(function() {
					$('#rosesTable').DataTable({
						responsive: true
					});
					
					$('#body').show();
				});
			}
			
			$scope.tableTitle = "Danh sách giống hoa";
			$http.get("/admin/api/rose/list").then(
				function(response) { // success
					$.each(response.data, function(idx, data) {
						data.imgsrc = data.numImgs > 0 ? '/images/rose/' + data.imgsrc : '';
					});
					$scope.roses = response.data;
					loaded();
				}, function(response) { // error
					$('#warning').show();
					loaded();
				}
			);
		});
		
		app.config(function($interpolateProvider) {
			$interpolateProvider.startSymbol('{');
			$interpolateProvider.endSymbol('}');
		});
    </script>
{{/extend}}
